<!-- Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT License. -->
<!-- This file shows how to design a first-run page that provides a welcome screen to the user about the features of the add-in. -->

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Contoso Task Pane Add-in</title>

    <!-- Office JavaScript API -->
    <script type="text/javascript" src="https://appsforoffice.microsoft.com/lib/1.1/hosted/office.js"></script>

    <!-- For more information on Fluent UI, visit https://developer.microsoft.com/fluentui#/. -->
    <link rel="stylesheet" href="https://static2.sharepointonline.com/files/fabric/office-ui-fabric-core/11.0.0/css/fabric.min.css"/>

    <!-- Template styles -->
    <link href="taskpane.css" rel="stylesheet" type="text/css" />
</head>

<body class="ms-font-m ms-welcome ms-Fabric">
    <header class="ms-welcome__header">
        <img width="150" height="150" src="../../assets/logo-filled.png" alt="Randers Kommunes budgetværktøjer" title="Randers Kommunes budgetværktøjer" />
       
    </header>
    <section id="sideload-msg" class="ms-welcome__main">
        <h2 class="ms-font-xl">Please <a target="_blank" href="https://learn.microsoft.com/office/dev/add-ins/testing/test-debug-office-add-ins#sideload-an-office-add-in-for-testing">sideload</a> your add-in to see app body.</h2>
    </section>
    <main id="app-body" class="ms-welcome__main" style="display: none;">

      <h2>1. Vælg dokumenttype</h2>
      <select id="dokumentDropdown" class="dropdown"></select>

      <h2>2. Vælg udvalg m.m.</h2>
      <select id="udvalgDropdown" class="dropdown"></select>
      <select id="bevillingsområdeDropdown" class="dropdown" style="visibility:hidden;">Vælg bevillingsområde</select>
      
      <h2>3. Værktøjer</h2>
      <div role="button" id="skabelon" class="ms-welcome__action ms-Button ms-Button--hero">
        <span class="ms-Button-label">Generer dokument</span>
    </div>

      <div role="button" id="addHeader" class="ms-welcome__action ms-Button ms-Button--hero ">
          <span class="ms-Button-label">Indsæt sidehoved</span>
      </div>

      <div role="button" id="run" class="ms-welcome__action ms-Button ms-Button--hero ">
          <span class="ms-Button-label">Alle udvalg og bevillingsområder</span>
      </div>
      </select>
      <div role="button" id="insertTable" class="ms-welcome__action ms-Button ms-Button--hero ">
          <span class="ms-Button-label">Indsæt test-tabel</span>
        </div>
      <div role="button" id="loadContentControls" class="ms-welcome__action ms-Button ms-Button--hero">
        <span class="ms-Button-label">Console log content controls</span>
      </div>
      <div role="button" id="indsætTest" class="ms-welcome__action ms-Button ms-Button--hero">
        <span class="ms-Button-label">Indsæt i content controls nr. 13</span>
      </div>
      <div role="button" id="rydAlt" class="ms-welcome__action ms-Button ms-Button--hero">
        <span class="ms-Button-label">Ryd alt</span>
      </div>


    </main>
</body>

<script>
let dropdownDokument = document.getElementById('dokumentDropdown');
dropdownDokument.length = 0;

let defaultOptionDokument = document.createElement('option');
defaultOptionDokument.text = 'Vælg dokument';

dropdownDokument.add(defaultOptionDokument);
dropdownDokument.selectedIndex = 0;

const dokumentURL = './assets/dokumenttype.json';
  
 fetch(dokumentURL)  
    .then(  
      function(response) {  
        if (response.status !== 200) {  
          console.warn('Fejl: ' + 
            response.status);  
          return;  
        }
  
        // Løber gennem alle svar
        responseJSON=response.json();
        responseJSON.then(function(data) {  
          let option;
      
          for (let i = 0; i < data.length; i++) {
            option = document.createElement('option');
              option.text = data[i].type;
             dropdownDokument.add(option); 
          }    
        });  
      }  
    )  
    .catch(function(err) {  
      console.error('Fetch Error -', err);  
    });
</script>

<script>
    let dropdownUdvalg = document.getElementById('udvalgDropdown');
    console.log(dropdownUdvalg)
    dropdownUdvalg.length = 0;
    
    let defaultOptionUdvalg = document.createElement('option');
    defaultOptionUdvalg.text = 'Vælg udvalg';
    
    dropdownUdvalg.add(defaultOptionUdvalg);
    dropdownUdvalg.selectedIndex = 0;
    
    const organisationURL = './assets/organisation.json';
    
   fetch(organisationURL)  
      .then(  
        function(response) {  
          if (response.status !== 200) {  
            console.warn('Fejl: ' + 
              response.status);  
            return;  
          }
    
          // Løber gennem alle svar
          responseJSON=response.json();
          responseJSON.then(function(data) {  
            let option;
        
            for (let i = 0; i < data.length; i++) {
              option = document.createElement('option');
                option.text = data[i].udvalg;
                //option.value = data[i].forkortelse;
                dropdownUdvalg.add(option); 
            }    
          });  
        }  
      )  
      .catch(function(err) {  
        console.error('Fetch Error -', err);  
      });
</script>

<script>
    const valgtBevillingsområde = document.getElementById("valgtBevillingsområde");
    
    udvalgDropdown.addEventListener("change", e => {

    dropdownBevillingsområde = document.getElementById('bevillingsområdeDropdown');
    dropdownBevillingsområde.style.visibility = "visible";
    dropdownBevillingsområde.length = 0;
    
    let defaultOption = document.createElement('option');
    defaultOption.text = 'Vælg bevillingsområde';
    
    dropdownBevillingsområde.add(defaultOption);
    dropdownBevillingsområde.selectedIndex = 0;

    fetch(organisationURL)  
      .then(  
        function(response) {  
            responseJSON=response.json();
            responseJSON.then(function(data) {  
                valgtIndex=document.getElementById("udvalgDropdown").selectedIndex-1; 
                bevillingsområdeAfgr=data[valgtIndex].bevillingsområde

                let option;
        
                for (let i = 0; i < bevillingsområdeAfgr.length; i++) {
                option = document.createElement('option');
                    option.text =  bevillingsområdeAfgr[i].navn;
                    dropdownBevillingsområde.add(option); 
                }    
            });  
        } 
      )  

        
       /*
        responsJSON.then(function(data) {
            
        }
        
        
        );
        */
        //valgtBevillingsomr.innerHTML = document.getElementById("udvalgDropdown").selectedIndex; 
        //valgtBevillingsomr.innerHTML =
    })
</script>


</html>

